<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
chan near_stop,stop_leave;
chan open1,close1,open2,close2,shut_closed1,shut_closed2;

const int N=4;
typedef int[0,N - 1] id_station;
const int S[id_station] = {0, 2284, 3292, 9097};
const int S0 = 10454;

//the number of trains
const int Nt=4;
typedef int[0,Nt - 1] id_train;
//delay to start
const int delayforurgent = 200;
const int D[id_station] = {0, 60, 120, 180};


typedef int[0,1] id_doorsgroup;
typedef int[0,1] id_dir;

const int Num=3;
typedef int[0,Num - 1] id_t;


broadcast chan urstop[id_train][id_train];
broadcast chan urstart[id_train];
broadcast chan urts[id_train];//train stopped urgently
broadcast chan change[id_train];//change direction


broadcast chan 
open_ScreenDoor[id_station][id_doorsgroup],shut_closed_ScreenDoor[id_station][id_t][id_doorsgroup],close_ScreenDoor[id_station][id_doorsgroup], 
open_TrainDoor[id_train],close_TrainDoor[id_train],shut_closed_TrainDoor[id_train][id_t],
trainstop[id_train][id_station][id_dir],
trainleave[id_train][id_station];</declaration><template><name x="5" y="5">AbstractTrain</name><parameter>id_train i</parameter><declaration>// Place local declarations here.
clock time;

int pos,cpos,v;
int j;

//update cpos
void uCPOS(){
cpos=cpos+v*time-time*time/4;
}</declaration><location id="id0" x="200" y="-152"><name x="184" y="-224">NEAR</name><label kind="invariant" x="144" y="-200">v*time/2&lt;=pos-cpos</label></location><location id="id1" x="368" y="-152"><urgent/></location><location id="id2" x="240" y="-344"><name x="216" y="-408">RECOVER</name><label kind="invariant" x="184" y="-392">time*time&lt;=4*(pos-cpos)</label></location><location id="id3" x="-72" y="-344"><name x="-88" y="-392">URINC</name><label kind="invariant" x="-136" y="-376">time*time&lt;=2*(pos-cpos)</label></location><location id="id4" x="-272" y="-56"><urgent/></location><location id="id5" x="-176" y="-152"><name x="-200" y="-136">URSTOP</name></location><location id="id6" x="-72" y="-152"><name x="-64" y="-192">URDEC</name><label kind="invariant" x="-64" y="-208">time&lt;=2*v/3</label></location><location id="id7" x="-40" y="16"><name x="-64" y="-32">STABLERUN</name><label kind="invariant" x="-64" y="24">pos-(cpos+20*time)
&gt;=500</label></location><location id="id8" x="200" y="16"><name x="208" y="40">RUN</name><label kind="invariant" x="208" y="56">time&lt;=40&amp;&amp;pos-time*time/4
&gt;=500</label></location><location id="id9" x="368" y="16"><urgent/></location><location id="id10" x="368" y="-64"><name x="312" y="-72">STOP</name></location><location id="id11" x="424" y="-120"><name x="414" y="-150">INIT</name><label kind="invariant" x="400" y="-176">time&lt;=D[i]</label></location><init ref="id11"/><transition action=""><source ref="id2"/><target ref="id6"/><label kind="select" x="248" y="-312">Tj:id_train</label><label kind="synchronisation" x="248" y="-288">urstop[i][Tj]?</label><label kind="assignment" x="112" y="-288">uCPOS(),
v=v-time/2,time=0</label><nail x="240" y="-256"/></transition><transition action=""><source ref="id3"/><target ref="id6"/><label kind="select" x="-64" y="-304">Tj:id_train</label><label kind="synchronisation" x="-64" y="-280">urstop[i][Tj]?</label><label kind="assignment" x="-224" y="-296">cpos=cpos+time*time/4,
v=time/2,time=0</label></transition><transition controllable="false" action=""><source ref="id7"/><target ref="id0"/><label kind="guard" x="16" y="-96">pos-(cpos+20*time)&lt;=500</label><label kind="assignment" x="32" y="-80">cpos=cpos+20*time,
v=20,time=0</label><nail x="80" y="-8"/><nail x="88" y="-40"/><nail x="176" y="-64"/></transition><transition controllable="false" action=""><source ref="id8"/><target ref="id0"/><label kind="guard" x="208" y="-96">pos-time*time/4
&lt;=500</label><label kind="assignment" x="208" y="-64">time=0,
cpos=
cpos+time*time/4,
v=time/2</label></transition><transition action=""><source ref="id0"/><target ref="id6"/><label kind="select" x="80" y="-176">Tj:id_train</label><label kind="synchronisation" x="24" y="-152">urstop[i][Tj]?</label><label kind="assignment" x="-56" y="-136">cpos=cpos+v*time-v*v*time*time/2000,
v=v-v*v*time/1000,time=0</label></transition><transition controllable="false" action=""><source ref="id0"/><target ref="id1"/><label kind="guard" x="216" y="-176">v*time/2==pos-cpos</label><label kind="assignment" x="224" y="-152">time=0,cpos=pos</label></transition><transition controllable="false" action=""><source ref="id1"/><target ref="id10"/><label kind="guard" x="304" y="-128">pos==S0</label><label kind="assignment" x="304" y="-112">cpos=S[0]</label></transition><transition controllable="false" action=""><source ref="id2"/><target ref="id1"/><label kind="guard" x="376" y="-320">time*time==4*(pos-cpos)</label><label kind="synchronisation" x="376" y="-288">trainstop[i][j][1]!</label><label kind="assignment" x="376" y="-272">cpos=pos,v=0,time=0</label><nail x="368" y="-344"/></transition><transition action=""><source ref="id3"/><target ref="id2"/><label kind="guard" x="56" y="-368">time*time==2*(pos-cpos)</label><label kind="assignment" x="64" y="-344">cpos=(pos+cpos)/2,
v=time/2,time=0</label></transition><transition controllable="false" action=""><source ref="id4"/><target ref="id3"/><label kind="guard" x="-240" y="-368">pos-cpos&lt;=800</label><label kind="assignment" x="-216" y="-336">time=0</label><nail x="-272" y="-344"/></transition><transition controllable="false" action=""><source ref="id4"/><target ref="id8"/><label kind="guard" x="-192" y="120">pos-cpos&gt;800</label><label kind="assignment" x="-96" y="120">time=0</label><nail x="-272" y="120"/><nail x="192" y="120"/></transition><transition action=""><source ref="id5"/><target ref="id4"/><label kind="synchronisation" x="-240" y="-176">urstart[i]?</label><nail x="-256" y="-152"/></transition><transition action=""><source ref="id6"/><target ref="id5"/><label kind="guard" x="-160" y="-224">time==2*v/3</label><label kind="synchronisation" x="-152" y="-208">urts[i]!</label><label kind="assignment" x="-160" y="-192">uCPOS(),
v=0,time=0</label></transition><transition action=""><source ref="id8"/><target ref="id6"/><label kind="select" x="-152" y="32">Tj:id_train</label><label kind="synchronisation" x="-160" y="56">urstop[i][Tj]?</label><label kind="assignment" x="-184" y="72">time=0,v=time/2,
cpos=cpos+time*time/4</label><nail x="184" y="80"/><nail x="-72" y="80"/></transition><transition action=""><source ref="id7"/><target ref="id6"/><label kind="select" x="-192" y="-80">Tj:id_train</label><label kind="synchronisation" x="-192" y="-56">urstop[i][Tj]?</label><label kind="assignment" x="-200" y="-40">time=0,v=20,
cpos=cpos+20*time</label><nail x="-72" y="16"/></transition><transition controllable="false" action=""><source ref="id8"/><target ref="id7"/><label kind="guard" x="96" y="-32">time==40</label><label kind="assignment" x="96" y="-16">cpos=400+cpos,
v=20,time=0</label></transition><transition controllable="false" action=""><source ref="id9"/><target ref="id8"/><label kind="guard" x="272" y="-8">j&lt;N-1</label><label kind="assignment" x="224" y="16">j=j+1,time=0,pos=S[j]</label></transition><transition action=""><source ref="id10"/><target ref="id9"/><label kind="synchronisation" x="272" y="-48">trainleave[i][j]?</label></transition><transition controllable="false" action=""><source ref="id11"/><target ref="id10"/><label kind="guard" x="392" y="-64">time==D[i]</label><label kind="synchronisation" x="392" y="-48">trainstop[i][j][1]!</label><label kind="assignment" x="392" y="-32">j=0,pos=S[j],
cpos=pos</label><nail x="424" y="-64"/></transition></template><template><name>AbstractTrainDoor</name><declaration>clock t;
int c1;</declaration><location id="id12" x="-496" y="-104"><name x="-520" y="-96">shut</name><label kind="invariant" x="-504" y="-80">t&lt;=2</label></location><location id="id13" x="-392" y="-104"><name x="-376" y="-120">open</name></location><location id="id14" x="-392" y="-200"><name x="-402" y="-230">part</name><label kind="invariant" x="-376" y="-216">t&lt;=2</label></location><location id="id15" x="-496" y="-200"><name x="-506" y="-230">closed</name></location><location id="id16" x="-608" y="-200"><name x="-624" y="-232">INIT</name><urgent/></location><init ref="id16"/><transition controllable="false" action=""><source ref="id13"/><target ref="id12"/><label kind="guard" x="-464" y="-144">c1==1</label><label kind="assignment" x="-424" y="-144">t=0</label><nail x="-408" y="-128"/><nail x="-472" y="-128"/></transition><transition controllable="false" action=""><source ref="id12"/><target ref="id16"/><label kind="guard" x="-600" y="-144">t==2</label><label kind="synchronisation" x="-600" y="-128">shut_closed1!</label><nail x="-608" y="-104"/></transition><transition controllable="false" action=""><source ref="id12"/><target ref="id14"/><label kind="guard" x="-544" y="-160">t&lt;2&amp;&amp;t&gt;0</label><nail x="-480" y="-144"/></transition><transition action=""><source ref="id13"/><target ref="id12"/><label kind="synchronisation" x="-464" y="-120">close1?</label><label kind="assignment" x="-480" y="-104">c1=1,t=0</label></transition><transition controllable="false" action=""><source ref="id14"/><target ref="id13"/><label kind="guard" x="-384" y="-168">t==2</label></transition><transition action=""><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="-464" y="-224">open1?</label><label kind="assignment" x="-472" y="-200">c1=0,t=0</label></transition><transition action=""><source ref="id16"/><target ref="id15"/><label kind="assignment" x="-592" y="-200">t=0,c1=0</label></transition></template><template><name>AbstractScreenDoor</name><declaration>clock t;
int c2;
</declaration><location id="id17" x="-496" y="-104"><name x="-520" y="-96">shut</name><label kind="invariant" x="-512" y="-80">t&lt;=2</label></location><location id="id18" x="-392" y="-104"><name x="-376" y="-120">open</name></location><location id="id19" x="-392" y="-200"><name x="-402" y="-230">part</name><label kind="invariant" x="-376" y="-216">t&lt;=2</label></location><location id="id20" x="-496" y="-200"><name x="-506" y="-230">closed</name></location><location id="id21" x="-608" y="-200"><name x="-624" y="-232">INIT</name><urgent/></location><init ref="id21"/><transition controllable="false" action=""><source ref="id18"/><target ref="id17"/><label kind="guard" x="-472" y="-144">c2==1</label><label kind="assignment" x="-432" y="-144">t=0</label><nail x="-408" y="-128"/><nail x="-480" y="-128"/></transition><transition controllable="false" action=""><source ref="id17"/><target ref="id21"/><label kind="guard" x="-600" y="-144">t==2</label><label kind="synchronisation" x="-600" y="-128">shut_closed2!</label><nail x="-608" y="-104"/></transition><transition controllable="false" action=""><source ref="id17"/><target ref="id19"/><label kind="guard" x="-544" y="-160">t&lt;2&amp;&amp;t&gt;0</label><nail x="-480" y="-144"/></transition><transition action=""><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-464" y="-120">close2?</label><label kind="assignment" x="-480" y="-104">c2=1,t=0</label></transition><transition controllable="false" action=""><source ref="id19"/><target ref="id18"/><label kind="guard" x="-384" y="-168">t==2</label></transition><transition action=""><source ref="id20"/><target ref="id19"/><label kind="synchronisation" x="-472" y="-216">open2?</label><label kind="assignment" x="-472" y="-200">c2=0,t=0</label></transition><transition action=""><source ref="id21"/><target ref="id20"/><label kind="assignment" x="-592" y="-200">t=0,c2=0</label></transition></template><template><name>Controller</name><declaration>clock t;
</declaration><location id="id22" x="-280" y="-88"><name x="-392" y="-104">openTrainDoor</name><label kind="invariant" x="-256" y="-96">t&lt;=30</label></location><location id="id23" x="-464" y="-64"><name x="-448" y="-80">Error</name></location><location id="id24" x="-544" y="-8"><name x="-608" y="8">closeScreenDoor</name></location><location id="id25" x="-416" y="-8"><name x="-472" y="8">trainDoorClosed</name></location><location id="id26" x="-544" y="-80"><name x="-528" y="-104">leave</name><label kind="invariant" x="-528" y="-88">t&lt;=5</label></location><location id="id27" x="-280" y="-8"><name x="-320" y="8">closeTrainDoor</name></location><location id="id28" x="-280" y="-160"><name x="-320" y="-200">openScreenDoor</name><label kind="invariant" x="-264" y="-168">t&lt;=5</label></location><location id="id29" x="-408" y="-160"><name x="-424" y="-192">stop</name><label kind="invariant" x="-418" y="-145">t&lt;=5</label></location><location id="id30" x="-544" y="-160"><name x="-554" y="-190">INIT</name></location><init ref="id30"/><transition action=""><source ref="id25"/><target ref="id24"/><label kind="synchronisation" x="-488" y="-32">close2!</label></transition><transition controllable="false" action=""><source ref="id24"/><target ref="id23"/><label kind="guard" x="-520" y="-64">t&lt;5</label><nail x="-520" y="-40"/></transition><transition action=""><source ref="id22"/><target ref="id27"/><label kind="guard" x="-264" y="-72">t&gt;=20</label><label kind="synchronisation" x="-272" y="-48">close1!</label></transition><transition action=""><source ref="id28"/><target ref="id22"/><label kind="synchronisation" x="-264" y="-144">open1!</label><label kind="assignment" x="-264" y="-128">t=0</label></transition><transition action=""><source ref="id30"/><target ref="id29"/><label kind="synchronisation" x="-520" y="-184">near_stop?</label><label kind="assignment" x="-496" y="-160">t=0</label><nail x="-424" y="-160"/></transition><transition action=""><source ref="id24"/><target ref="id26"/><label kind="guard" x="-600" y="-64">t&gt;=5</label><label kind="synchronisation" x="-640" y="-48">shut_closed2?</label><label kind="assignment" x="-584" y="-32">t=0</label></transition><transition action=""><source ref="id27"/><target ref="id25"/><label kind="synchronisation" x="-400" y="-32">shut_closed1?</label><label kind="assignment" x="-360" y="-8">t=0</label></transition><transition action=""><source ref="id26"/><target ref="id30"/><label kind="synchronisation" x="-624" y="-128">stop_leave!</label></transition><transition action=""><source ref="id29"/><target ref="id28"/><label kind="synchronisation" x="-368" y="-184">open2!</label><label kind="assignment" x="-360" y="-160">t=0</label><nail x="-400" y="-160"/></transition></template><system>system AbstractTrain,AbstractTrainDoor,AbstractScreenDoor,Controller;</system></nta>